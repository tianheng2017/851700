<include file="public/header" title="注册" body="g4"/>
<include file="public/header_nav" title="注册" href="javascript:history.back(-1)"/>
<link rel="stylesheet" href="__STATIC__/css/iosSelect.css">
<style>
	header{
		position:relative!important;
		opacity: 100;
		background: unset;
	}
	.singupphone .content30 .signup-find {
		padding-top: 1rem;
	}
</style>
<!--注册表单-s-->
<div class="loginsingup-input singupphone">
    <form action="" method="post" onSubmit="return checkSubmit()" >
        <div class="content30">
            <div class="lsu boo wicheck">
                <input type="text" name="username" id="username" value="" placeholder="请输入手机号"  class="c-form-txt-normal" onBlur="checkMobilePhone(this.value);">
                <span id="mobile_phone_notice"></span>
            </div>
            <div class="lsu boo wicheck">
                <input type="password" name="password" id="password" value="" placeholder="请设置6-20位登录密码" class="c-form-txt-normal" onBlur="check_password(this.value);">
                <span id="password_notice"></span>
            </div>
            <div class="lsu boo wicheck">
                <input type="password" id="password2" name="password2" value="" placeholder="确认密码" onBlur="check_confirm_password(this.value);">
                <span id="confirm_password_notice"></span>
            </div>
            <if condition="$regis_sms_enable eq 1">
                <div class="lsu boo zc_se">
                    <input type="text" id="mobile_code" value="" name="mobile_code" placeholder="请输入验证码" maxlength="4">
                    <a rel="mobile" onClick="sendcode(this)">获取短信验证码</a>
                </div>
            </if>
			<div class="myorder p" style="margin-top: 1.28rem;padding: 0 .64rem 0 0;height: 1.83467rem;line-height: 1.83467rem;border-radius: .128rem;">
				<a href="javascript:void(0)" onclick="locationaddress(this);">
					<div class="order">
						<div class="fl" style="width: 14.3rem;">
							<input id="area" value=""  type="text" style="height: 1.83467rem;padding: 0 .41333rem;font-size: .59733rem;width: 14.3rem;border: none;" placeholder="请选择所在地区" readonly>
							<input type="hidden" name="province" class="hiddle_area"/>
							<input type="hidden" name="city" class="hiddle_area"/>
							<input type="hidden" name="district" class="hiddle_area"/>
						</div>
					</div>
				</a>
			</div>
            <div class="lsu submit">
                <input type="submit" name="" id="" value="注册"/>
            </div>
            <div class="signup-find">
                <p class="recept">注册即视为同意<a href="">《注册协议》</a></p>
            </div>
        </div>
    </form>
</div>
<!--选择地区-s-->
<div class="container">
    <div class="city">
        <div class="screen_wi_loc" style="width: 10rem!important;">
            <div class="classreturn loginsignup" style="width: 12rem!important;">
                <div class="content">
                    <div class="ds-in-bl return seac_retu">
                        <a href="javascript:void(0);" onclick="closelocation();"><img src="__STATIC__/images/return.png" alt="返回"></a>
                    </div>
                    <div class="ds-in-bl search center">
                        <span class="sx_jsxz">选择地区</span>
                    </div>
                    <div class="ds-in-bl suce_ok">
                        <a href="javascript:void(0);">&nbsp;</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="province-list"></div>
        <div class="city-list" style="display:none"></div>
        <div class="area-list" style="display:none"></div>
    </div>
</div>
<!--选择地区-e-->
<div class="mask-filter-div" style="display: none;"></div>
<script src="__STATIC__/js/mobile-location.js"></script>
<script type="text/javascript">
    function locationaddress(e){
        $('.container').animate({width: '10rem', opacity: 'show'}, 'normal',function(){
            $('.container').show();
        });
        if(!$('.container').is(":hidden")){
            $('body').css('overflow','hidden')
            cover();
            $('.mask-filter-div').css('z-index','9999');
        }
    }
    function closelocation(){
        var province_div = $('.province-list');
        var city_div = $('.city-list');
        var area_div = $('.area-list');
        if(area_div.is(":hidden") == false){
            area_div.hide();
            city_div.show();
            province_div.hide();
            return;
        }
        if(city_div.is(":hidden") == false){
            area_div.hide();
            city_div.hide();
            province_div.show();
            return;
        }
        if(province_div.is(":hidden") == false){
            area_div.hide();
            city_div.hide();
            $('.container').animate({width: '0', opacity: 'show'}, 'normal',function(){
                $('.container').hide();
            });
            undercover();
            $('.mask-filter-div').css('z-index','inherit');
            return;
        }
    }
    $('body').on('click', '.area-list p', function () {
        var area = ' '+getCookie('province_name')+' '+getCookie('city_name')+' '+getCookie('district_name');
        $("#area").val(area);
        $("input[name=province]").val(getCookie('province_id'));
        $("input[name=city]").val(getCookie('city_id'));
        $("input[name=district]").val(getCookie('district_id'));
    });
</script>
<!--注册表单-s-->
<!--script src="__STATIC__/js/form-common.js" type="text/javascript"></script-->
<script type="text/javascript">
    var flag = false;
    //手机验证
    function checkMobilePhone(mobile){
        if(mobile == ''){
            showErrorMsg('手机不能空');
            flag = false;
        }else if(checkMobile(mobile)){ //判断手机格式
            $.ajax({
                type : "GET",
                url:"/index.php?m=Home&c=Api&a=issetMobile",//+tab,
//			url:"{:U('Mobile/User/comment',array('status'=>$_GET['status']),'')}/is_ajax/1/p/"+page,//+tab,
                data :{mobile:mobile},// 你的formid 搜索表单 序列化提交
                success: function(data)
                {
                    if(data == '0')
                    {
                       flag = true;
                    }else{
                        showErrorMsg('* 手机号已存在');
                       flag = false;
                    }
                }
            });
        }else{
            showErrorMsg('* 手机号码格式不正确');
           flag = false;
        }
    }

    //密码
    function check_password(password) {
        var password = $.trim(password);
        if(password == ''){
            showErrorMsg("*登录密码不能包含空格");
           flag = false;
        }else if (password.length < 6) {
            showErrorMsg('*登录密码不能少于 6 个字符。');
           flag = false;
        }
    }

    //验证确认密码
    function check_confirm_password(confirm_password) {
        var password1 = $.trim($('#password').val());
        var password2 = $.trim(confirm_password);
        if (password1 == '') {
            showErrorMsg("*确认密码不能包含空格");
           flag = false;
        }
        if (password2.length < 6) {
            showErrorMsg('*登录密码不能少于 6 个字符。');
           flag = false;
        }
        if (password2 != password1) {
            showErrorMsg('*两次密码不一致');
           flag = false;
        }else{
            flag = true;
        }
    }

    function countdown(obj) {
        var s = 150;
        //改变按钮状态
        obj.disabled = true;
        callback();
        //循环定时器
        var T = window.setInterval(callback,1000);
        function callback()
        {
            if(s <= 0){
                //移除定时器
                window.clearInterval(T);
                obj.disabled=false;
                obj.innerHTML='获取短信验证码';
            }else{
                if(s<=10){
                    obj.innerHTML = '0'+ --s + '秒后再获取';
                }else{
                    obj.innerHTML = --s+ '秒后再获取';
                }
            }
        }
    }

    //发送短信验证码
    function sendcode(obj){
        if(flag){
            $.ajax({
                url:'/index.php?m=Home&c=Api&a=send_validate_code&t='+Math.random() ,
                type:'post',
                dataType:'json',
                data:{type:$(obj).attr('rel'),send:$.trim($('#username').val()), scene:1},
                success:function(res){
                    if(res.status==1){
                        //成功
                        countdown(obj)
                        showErrorMsg(res.msg);
                    }else{
                        //失败
                        showErrorMsg(res.msg);
                    }
                }
            })
        }
    }

    //提交表单
    function checkSubmit()
    {
        var username = $.trim($('#username').val());
        var password = $.trim($('#password').val());
        var password2= $.trim($('#password2').val());
        var mobile_code= $.trim($('#mobile_code').val());
        if(username.length >0 && password.length > 0 && password2.length > 0 && flag)
        {
            return true;
        } else{
            //失败
            showErrorMsg('请按要求填写信息');
            return false;
        }

    }

</script>
	</body>
</html>
