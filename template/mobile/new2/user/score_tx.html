<include file="public/header" title="鱼分提现" body=""/>
<include file="public/header_nav" title="鱼分提现" href="javascript:history.back(-1)"/>
<style>
	.btn{
	    display: inline-block;
		height: 1.2rem;
		line-height: 1.2rem;
		padding: 0 .5rem;
		background-color: #FF5722;
		color: #fff;
		white-space: nowrap;
		text-align: center;
		font-size: .55rem;
		border: none;
		border-radius: .1rem;
		cursor: pointer;
		position: absolute;
		top: .35rem;
		left: 4rem;
	}
</style>
<div class="loginsingup-input ma-to-20">
	<form action="/Mobile/User/score_tx" method="post" onsubmit="return checkSubmit()" style="background-color: #fff;padding-bottom: 1rem;" enctype="multipart/form-data">
		<div class="content30">
			<div class="lsu" style="height: 1.83467rem;line-height: 1.83467rem;">
				<span>可用鱼分：</span>
				<span style="color:red;font-weight:bold;">{$pay_points}</span>
			</div>
			<div class="lsu">
				<span>提现数量：</span>
				<input type="text" name="money" id="money" value="" paypoints="{$pay_points}" placeholder="实际到帐将扣除{$fee}%手续费" onKeyUp="this.value=this.value.replace(/[^\d]/g,'')">
			</div>
			<div class="lsu">
				<span>收款二微码：</span>
				<div class="btn">选择二微码</div>
				<input type="file" name="account_bank" onchange="showImg(this)" id="account_bank" value=""  placeholder="请上传收款二微码" style="padding-top: 0.45rem;opacity:0;">
			</div>
			<div style="text-align:center;">
				<img id="upload" width="50%" height="50%" style="margin-top:.5rem;">
			</div>
			<div class="lsu zc_se">
				<span>短信验证码：</span>
				<input type="text" name="mobile_code" style="width: 6.5rem;" id="mobile_code" value="" placeholder="请输入短信验证码" maxlength="4">
				<a rel="mobile" onClick="sendcode(this)" style="padding: .4rem .21333rem;cursor:pointer;">获取验证码</a>
			</div>
			<div class="lsu submit">
				<input type="submit" name="" id="" value="提交申请" style="margin-top:.5rem;">
			</div>
		</div>
	</form>
</div>
<script src="__STATIC__/js/form-common.js" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8">
    function countdown(obj) {
        var s = 150;
        //改变按钮状态
        obj.disabled = true;
        callback();
        //循环定时器
        var T = window.setInterval(callback,1000);
        function callback()
        {
            if(s <= 0){
                //移除定时器
                window.clearInterval(T);
                obj.disabled=false;
				$('#mobile_code').css('width', '6.5rem');
                obj.innerHTML='获取验证码';
            }else{
                if(s<=10){
                    obj.innerHTML = '0'+ --s + '秒后再获取';
                }else{
                    obj.innerHTML = --s+ '秒后再获取';
                }
            }
        }
    }

    //发送短信验证码
    function sendcode(obj){
		$.ajax({
			url:'/index.php?m=Home&c=Api&a=send_validate_code&t='+Math.random(),
			type:'post',
			dataType:'json',
			data:{type:$(obj).attr('rel'),send:'{$user.mobile}', scene:1},
			success:function(res){
				if(res.status==1){
					//成功
					$('#mobile_code').css('width', '5.5rem');
					countdown(obj)
					showErrorMsg(res.msg);
				}else{
					//失败
					showErrorMsg(res.msg);
				}
			}
		});
    }
	function showImg(input) {
		var file = input.files[0];
		var url = window.URL.createObjectURL(file);
		$('#upload').attr('src', url);
		$('.btn').text('已经选择');
	}

    /**
     * 提交表单
     * */
    function checkSubmit(){
        var account_bank = $.trim($('#account_bank').val());
        var money = parseFloat($.trim($('#money').val()));
        var paypoints = parseFloat({$pay_points});
		var mobile_code = $.trim($('#mobile_code').val());
        if(account_bank=='' || money == '' || mobile_code == ''){
            showErrorMsg("所有信息为必填")
            return false;
        }
        if(money > paypoints){
            showErrorMsg("提现额度大于您的鱼分余额")
            return false;
        }
    }
</script>
	</body>
</html>
